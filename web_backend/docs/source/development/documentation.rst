.. _development-documentation:

Development: Documentation
==========================

This page explains how to **modify the documentation**.

The documentation is generated using the library `sphinx <http://www.sphinx-doc.org/en/master/>`__,
which uses `reStructuredText <https://es.wikipedia.org/wiki/ReStructuredText>`__ as its markup language,
and supports the following output formats:

* HTML
* LaTeX
* ePub
* Texinfo
* Manual pages
* Plain text

Apart of the documentation, a good start point is this `CheatSheet <http://openalea.gforge.inria.fr/doc/openalea/doc/_build/html/source/sphinx/rest_syntax.html>`__.



Dependencies
------------

The sphinx library is required for modifying the documentation.



How to modify the documentation
-------------------------------

Directory structure and important files
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

All the documentation files are in the **<project-root-path>/web_backend/docs folder**. The most important elements of the folder are:

* **build** folder: Contains the documentation in the output formats specified with the make command (HTML, ...)
* **source** folder: Contains the source files of the documentation.
    * **_api-non-autogenerated-files** folder contains txt files that substitute the content of the specified .rst files
      generated by generate-api-doc.sh. The name of the files must be the same as the name of the api file to be substituted,
      but the extension must be .txt to avoid sphinx trying to use them. A line like the showed below must be included in the
      generate-api-doc.sh file:
      ::

        cat _api-non-autogenerated-files/<file-name>.txt > api/<file-name>.rst

* **generate-api-doc.sh**: Generates the automatic documentation of the api of the project,
  using `sphinx-apidoc <http://www.sphinx-doc.org/es/stable/man/sphinx-apidoc.html>`__. It also substitutes the content
  of the files specified in _api-non-autogenerated-files, as described in the point above, and removes the lines 3-10
  of the package files of the api, to avoid having an extra header [#f1]_.

Generate HTML files
^^^^^^^^^^^^^^^^^^^

After generating them, the HTML files will be stored in the **<project-root-path>/web_backend/docs/build/html** folder.

No changes in API
"""""""""""""""""

If there are no changes in the API source code, to generate the HTML files of the documentation follow this steps:

::

    cd <project-root-path>/web_backend/docs
    make html

.. note:: If there are no changes in the API, the instructions in the section below can also be used,
   but is more correct to use the ones explained in this section.

Changes in API
""""""""""""""

If there are changes in the API source code, to generate the HTML files of the documentation follow this steps:

::

    cd <project-root-path>/web_backend/docs
    ./generate-api-doc.sh

.. note:: **If a new python package is added** to the source code (i.e. a web_backend.package folder with __init__.py file),
   a line like the one below must be added to the **generate-api-doc.sh** file before executing it:

   ::

      sed -i'.original' -e '3,10d' api/web_backend.<package-name>.rst

Style
^^^^^

The default html theme is 'nature', which is the same as the one used in the `pandas documentation <http://pandas.pydata.org/pandas-docs/stable/index.html>`__
To change the theme, the following variable in the **conf.py** file have to be changed:

::

    html_theme = 'nature'

Possible values are described in the `sphinx-theme page <https://sphinx-themes.org>`__.


Warnings
^^^^^^^^

After using the generate-api-doc.sh to update the API documentation, sphinx
can give warnings if some of the .rst files are not included in any toctree.

Currently, the web_backend.rst file is not included in any toctree,
because with the modules.rst is considered enough to show the packages and
modules of the library.

For that reason, sphinx gives the following warning:

.. code-block:: none

   api/web_backend.rst: WARNING: document isn't included in any toctree

This warning can be ignored, because this file isn't included intentionally.

.. rubric:: Footnotes

.. [#f1] This avoids having a toctree with unuseful elements like 'submodules' header.
